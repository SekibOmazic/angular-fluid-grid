/*
 * fluid-grid
 * http://SekibOmazic.github.io/angular-fluid-grid
 *
 * @version: 0.0.1
 * @license: MIT
 */

!function(a){"use strict";function b(b){a.extend(this,b),this.resizable=a.extend({},b.resizable||{}),this.draggable=a.extend({},b.draggable||{}),this.grid=[],this.destroy=function(){this.grid.length=0,this.grid=null},this.setOptions=function(b){if(b)if(b=a.extend({},b),b.draggable&&(a.extend(this.draggable,b.draggable),delete b.draggable),b.resizable&&(a.extend(this.resizable,b.resizable),delete b.resizable),a.extend(this,b),this.margins&&2===this.margins.length)for(var c=0,d=this.margins.length;d>c;++c)this.margins[c]=parseInt(this.margins[c],10),isNaN(this.margins[c])&&(this.margins[c]=0);else this.margins=[0,0]},this.canItemOccupy=function(a,b,c){return b>-1&&c>-1&&a.sizeX+c<=this.columns},this.autoSetItemPosition=function(a){for(var b=0;b<this.maxRows;++b)for(var c=0;c<this.columns;++c){var d=this.getItems(b,c,a.sizeX,a.sizeY,a);if(0===d.length&&this.canItemOccupy(a,b,c))return void this.putItem(a,b,c)}throw new Error("Unable to place item!")},this.getItems=function(a,b,c,d,e){var f=[];c&&d||(c=d=1),!e||e instanceof Array||(e=[e]);for(var g=0;d>g;++g)for(var h=0;c>h;++h){var i=this.getItem(a+g,b+h,e);!i||e&&-1!==e.indexOf(i)||-1!==f.indexOf(i)||f.push(i)}return f},this.removeItem=function(a){for(var b=0,c=this.grid.length;c>b;++b){var d=this.grid[b];if(d){var e=d.indexOf(a);if(-1!==e){d[e]=null;break}}}this.floatItemsUp(),this.updateHeight()},this.getItem=function(a,b,c){!c||c instanceof Array||(c=[c]);for(var d=1;a>-1;){for(var e=1,f=b;f>-1;){var g=this.grid[a];if(g){var h=g[f];if(h&&(!c||-1===c.indexOf(h))&&h.sizeX>=e&&h.sizeY>=d)return h}++e,--f}--a,++d}return null},this.putItems=function(a){for(var b=0,c=a.length;c>b;++b)this.putItem(a[b])},this.putItem=function(a,b,c,d){if(("undefined"==typeof b||null===b)&&(b=a.row,c=a.col,"undefined"==typeof b||null===b))return void this.autoSetItemPosition(a);if(this.canItemOccupy(a,b,c)||(c=Math.min(this.columns-a.sizeX,Math.max(0,c)),b=Math.max(0,b)),a&&null!==a.oldRow&&"undefined"!=typeof a.oldRow){if(a.oldRow===b&&a.oldColumn===c)return a.row=b,void(a.col=c);var e=this.grid[a.oldRow];e&&e[a.oldColumn]===a&&delete e[a.oldColumn]}a.oldRow=a.row=b,a.oldColumn=a.col=c,this.moveOverlappingItems(a,d),this.grid[b]||(this.grid[b]=[]),this.grid[b][c]=a},this.moveOverlappingItems=function(a,b){b?-1===b.indexOf(a)&&(b=b.slice(0),b.push(a)):b=[a];var c=this.getItems(a.row,a.col,a.sizeX,a.sizeY,b);this.moveItemsDown(c,a.row+a.sizeY,b)},this.moveItemsDown=function(a,b,c){if(a&&0!==a.length){a.sort(function(a,b){return a.row-b.row}),c=c?c.slice(0):[];var d,e,f,g={};for(e=0,f=a.length;f>e;++e){d=a[e];var h=g[d.col];("undefined"==typeof h||d.row<h)&&(g[d.col]=d.row)}for(e=0,f=a.length;f>e;++e){d=a[e];var i=b-g[d.col];this.moveItemDown(d,d.row+i,c),c.push(d)}}},this.moveItemDown=function(a,b,c){if(!(a.row>=b)){for(;a.row<b;)++a.row,this.moveOverlappingItems(a,c);this.putItem(a,a.row,a.col,c)}},this.floatItemsUp=function(){if(this.floating!==!1)for(var a=0,b=this.grid.length;b>a;++a){var c=this.grid[a];if(c)for(var d=0,e=c.length;e>d;++d)c[d]&&this.floatItemUp(c[d])}},this.floatItemUp=function(a){for(var b=a.col,c=a.sizeY,d=a.sizeX,e=null,f=null,g=a.row-1;g>-1;){var h=this.getItems(g,b,d,c,a);if(0!==h.length)break;e=g,f=b,--g}null!==e&&this.putItem(a,e,f)},this.updateHeight=function(a){var b=this.minRows;a||(a=0);for(var c=this.grid.length;c>=0;--c){var d=this.grid[c];if(d)for(var e=0,f=d.length;f>e;++e)d[e]&&(b=Math.max(b,c+a+d[e].sizeY))}this.gridHeight=this.maxRows-b>0?Math.min(this.maxRows,b):Math.max(this.maxRows,b)},this.pixelsToRows=function(a,b){return b===!0?Math.ceil(a/this.curRowHeight):b===!1?Math.floor(a/this.curRowHeight):Math.round(a/this.curRowHeight)},this.pixelsToColumns=function(a,b){return b===!0?Math.ceil(a/this.curColWidth):b===!1?Math.floor(a/this.curColWidth):Math.round(a/this.curColWidth)}}function c(b,c,d){return{restrict:"EAC",transclude:!0,replace:!0,template:'<div ng-class="fluidGridClass()"><div ng-style="previewStyle()" class="fluid-grid-item fluid-grid-preview-holder"></div><div ng-transclude></div></div>',controller:"FluidGridCtrl",controllerAs:"fluidGrid",scope:{config:"=?fluidGrid"},compile:function(){return function(e,f,g,h){function i(){var a=parseInt(f.css("width"))||f.prop("offsetWidth");a===m||h.movingItem||(m=a,h.loaded&&f.removeClass("fluid-grid-loaded"),k(),h.loaded&&f.addClass("fluid-grid-loaded"))}function j(){i(),b(function(){e.$apply()})}h.loaded=!1,e.fluidGridClass=function(){return{"fluid-grid":!0,"fluid-grid-desktop":!h.isMobile,"fluid-grid-mobile":h.isMobile,"fluid-grid-loaded":h.loaded}},e.previewStyle=function(){return h.movingItem?{display:"block",height:h.movingItem.sizeY*h.curRowHeight-h.margins[0]+"px",width:h.movingItem.sizeX*h.curColWidth-h.margins[1]+"px",top:h.movingItem.row*h.curRowHeight+(h.outerMargin?h.margins[0]:0)+"px",left:h.movingItem.col*h.curColWidth+(h.outerMargin?h.margins[1]:0)+"px"}:{display:"none"}};var k=function(){h.setOptions(e.config),h.curWidth="auto"===h.width?parseInt(f.css("width"))||parseInt(f.prop("offsetWidth")):h.width,h.curColWidth="auto"===h.colWidth?parseInt((h.curWidth+(h.outerMargin?-h.margins[1]:h.margins[1]))/h.columns):h.colWidth,h.curRowHeight="match"===h.rowHeight?h.curColWidth:h.rowHeight,h.isMobile=h.curWidth<=h.mobileBreakPoint;for(var a=0,b=h.grid.length;b>a;++a){var c=h.grid[a];if(c)for(var d=0,g=c.length;g>d;++d)if(c[d]){var i=c[d];i.setElementPosition(),i.setElementSizeY(),i.setElementSizeX()}}l()};e.$watch("config",k,!0),e.$watch("config.draggable",function(){c.$broadcast("fluid-grid-draggable-changed")},!0),e.$watch("config.resizable",function(){c.$broadcast("fluid-grid-resizable-changed")},!0);var l=function(){f.css("height",h.gridHeight*h.curRowHeight+(h.outerMargin?h.margins[0]:-h.margins[0])+"px")};e.$watch("fluidGrid.gridHeight",l);var m=parseInt(f.css("width"))||f.prop("offsetWidth");"function"==typeof f.resize&&f.resize(j);var n=a.element(d);n.on("resize",j),e.$watch(function(){var a=parseInt(f.css("width"))||f.prop("offsetWidth");return a},i),e.$on("$destroy",function(){h.destroy(),n.off("resize",j)}),b(function(){e.$watch("fluidGrid.floating",function(){h.floatItemsUp()}),h.loaded=!0},100)}}}}function d(){this.$element=null,this.fluidGrid=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.init=function(a,b){this.$element=a,this.fluidGrid=b,this.sizeX=b.defaultSizeX,this.sizeY=b.defaultSizeY},this.destroy=function(){this.fluidGrid=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.fluidGrid.movingItem===this},this.setPosition=function(a,b){this.fluidGrid.putItem(this,a,b),this.fluidGrid.loaded&&this.fluidGrid.floatItemsUp(),this.fluidGrid.updateHeight(this.isMoving()?this.sizeY:0),this.isMoving()||this.setElementPosition()},this.setSize=function(a,b){a=a.toUpperCase();var c="size"+a,d="Size"+a;if(""!==b){b=parseInt(b,10),(isNaN(b)||0===b)&&(b=this.fluidGrid["default"+d]);var e=!(this[c]===b&&this["old"+d]&&this["old"+d]===b);this["old"+d]=this[c]=b,this.isMoving()||this["setElement"+d](),e&&(this.fluidGrid.moveOverlappingItems(this),this.fluidGrid.loaded&&this.fluidGrid.floatItemsUp(),this.fluidGrid.updateHeight(this.isMoving()?this.sizeY:0))}},this.setSizeY=function(a){this.setSize("y",a)},this.setSizeX=function(a){this.setSize("x",a)},this.setElementPosition=function(){this.$element.css(this.fluidGrid.isMobile?{margin:this.fluidGrid.margins[0]+"px",top:"auto",left:"auto"}:{margin:"0px",top:this.row*this.fluidGrid.curRowHeight+(this.fluidGrid.outerMargin?this.fluidGrid.margins[0]:0)+"px",left:this.col*this.fluidGrid.curColWidth+(this.fluidGrid.outerMargin?this.fluidGrid.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.fluidGrid.isMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.fluidGrid.curRowHeight-this.fluidGrid.margins[0]+"px")},this.setElementSizeX=function(){this.fluidGrid.isMobile?this.$element.css("width","auto"):this.$element.css("width",this.sizeX*this.fluidGrid.curColWidth-this.fluidGrid.margins[1]+"px")}}function e(b,c,d){return{restrict:"EA",controller:"FluidGridItemCtrl",require:["^fluidGrid","fluidGridItem"],link:function(e,f,g,h){function i(){return p.draggable.handle?a.element(f[0].querySelector(p.draggable.handle)):f}function j(){return f[0].querySelectorAll(".fluid-grid-item-resizable-handler")}function k(){function a(a){p.draggable.handle&&a.currentTarget!==a.target||(v=a.pageX,w=a.pageY,k=parseInt(f.css("left")),l=parseInt(f.css("top")),m=parseInt(f.css("width")),o=parseInt(f.css("height")),r=q.col,s=q.row,g(a),c.bind("mousemove",b),c.bind("mouseup",d),a.preventDefault(),a.stopPropagation())}function b(a){t=a.pageX,u=a.pageY;var b=t-v+x,c=u-w+y;x=y=0,v=t,w=u;var d=b,e=c;B>k+d?(b=B-k,x=d-b):k+m+d>C&&(b=C-k-m,x=d-b),z>l+e?(c=z-l,y=e-c):l+o+e>A&&(c=A-l-o,y=e-c),k+=b,l+=c,f.css({top:l+"px",left:k+"px"}),h(a),a.stopPropagation(),a.preventDefault()}function d(a){c.unbind("mouseup",d),c.unbind("mousemove",b),x=y=0,j(a)}function g(a){f.addClass("fluid-grid-item-moving"),p.movingItem=q,p.updateHeight(q.sizeY),e.$apply(function(){p.draggable&&p.draggable.start&&p.draggable.start(a,f,n)})}function h(a){q.row=p.pixelsToRows(l),q.col=p.pixelsToColumns(k),e.$apply(function(){p.draggable&&p.draggable.drag&&p.draggable.drag(a,f,n)})}function j(a){f.removeClass("fluid-grid-item-moving");var b=p.pixelsToRows(l),c=p.pixelsToColumns(k);(p.pushing!==!1||0===p.getItems(b,c,q.sizeX,q.sizeY,q).length)&&(q.row=b,q.col=c),p.movingItem=null;var d=r!==q.col||s!==q.row;e.$apply(function(){d&&p.draggable&&p.draggable.stop&&p.draggable.stop(a,f,n)}),q.setPosition(q.row,q.col),p.updateHeight()}var k,l,m,o,r,s,t=0,u=0,v=0,w=0,x=0,y=0,z=0,A=9999,B=0,C=p.curWidth-1,D=i();p.draggable.enabled?D.bind("mousedown",a):D.unbind("mousedown")}function l(){p.resizable.handles.forEach(function(b){function d(a){x=a.pageX,y=a.pageY,l=parseInt(f.css("left")),m=parseInt(f.css("top")),o=parseInt(f.css("width")),r=parseInt(f.css("height")),s=q.sizeX,t=q.sizeY,g(a),c.bind("mousemove",h),c.bind("mouseup",i),a.preventDefault(),a.stopPropagation()}function g(a){f.addClass("fluid-grid-item-moving"),p.movingItem=q,q.setElementSizeX(),q.setElementSizeY(),q.setElementPosition(),e.$apply(function(){p.resizable&&p.resizable.start&&p.resizable.start(a,f,n)})}function h(a){v=a.pageX,w=a.pageY;var b=v-x+z,c=w-y+A;z=A=0,x=v,y=w;var d=c,e=b;u.indexOf("n")>=0&&(F>r-d?(c=r-F,A=d-c):B>m+d&&(c=B-m,A=d-c),m+=c,r-=c),u.indexOf("s")>=0&&(F>r+d?(c=F-r,A=d-c):m+r+d>C&&(c=C-m-r,A=d-c),r+=c),u.indexOf("w")>=0&&(G>o-e?(b=o-G,z=e-b):D>l+e&&(b=D-l,z=e-b),l+=b,o-=b),u.indexOf("e")>=0&&(G>o+e?(b=G-o,z=e-b):l+o+e>E&&(b=E-l-o,z=e-b),o+=b),f.css({top:m+"px",left:l+"px",width:o+"px",height:r+"px"}),j(a),a.preventDefault(),a.stopPropagation()}function i(a){c.unbind("mouseup",i),c.unbind("mousemove",h),z=A=0,k(a)}function j(a){q.row=p.pixelsToRows(m,!1),q.col=p.pixelsToColumns(l,!1),q.sizeX=p.pixelsToColumns(o,!0),q.sizeY=p.pixelsToRows(r,!0),e.$apply(function(){p.resizable&&p.resizable.resize&&p.resizable.resize(a,f,n)})}function k(a){f.removeClass("fluid-grid-item-moving"),p.movingItem=null,q.setPosition(q.row,q.col),q.setSizeY(q.sizeY),q.setSizeX(q.sizeX);var b=s!==q.sizeX||t!==q.sizeY;e.$apply(function(){b&&p.resizable&&p.resizable.stop&&p.resizable.stop(a,f,n)})}var l,m,o,r,s,t,u=b,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=9999,D=0,E=p.curWidth-1,F=p.curRowHeight-p.margins[0],G=p.curColWidth-p.margins[1];if(p.resizable.enabled){var H=a.element('<div class="fluid-grid-item-resizable-handler handle-'+u+'"></div>');f.append(H),H.bind("mousedown",d)}else{var I=c[0].querySelectorAll(".fluid-grid-item-resizable-handler");I.length&&a.element(I).remove()}})}function m(){q.setPosition(q.row,q.col),t.row&&t.row.assign&&t.row.assign(e,q.row),t.col&&t.col.assign&&t.col.assign(e,q.col)}var n,o=g.fluidGridItem,p=h[0],q=h[1];if(o){var r=b(o);n=r(e)||{},!n&&r.assign&&(n={row:q.row,col:q.col,sizeX:q.sizeX,sizeY:q.sizeY},r.assign(e,n))}else n=g;q.init(f,p),f.addClass("fluid-grid-item");for(var s=["sizeX","sizeY","row","col"],t={},u=function(a){var c;if("string"==typeof n[a])c=n[a];else if("string"==typeof n[a.toLowerCase()])c=n[a.toLowerCase()];else{if(!o)return;c=b(o+"."+a)}t[a]=b(c),e.$watch(c,function(b){b=parseInt(b,10),isNaN(b)||(q[a]=b)});var d=t[a](e);"number"==typeof d&&(q[a]=d)},v=0,w=s.length;w>v;++v)u(s[v]);if(e.$watch(function(){return q.row},m),e.$watch(function(){return q.col},m),e.$on("fluid-grid-draggable-changed",k),e.$on("fluid-grid-resizable-changed",l),k(),l(),e.$watch(function(){return q.sizeY},function(a){q.setSizeY(a),t.sizeY&&t.sizeY.assign&&t.sizeY.assign(e,q.sizeY)}),e.$watch(function(){return q.sizeX},function(a){q.setSizeX(a),t.sizeX&&t.sizeX.assign&&t.sizeX.assign(e,q.sizeX)}),p.dynamicContent&&p.dynamicContent.name&&n[p.dynamicContent.name]){var x=a.element(f[0].querySelector(p.dynamicContent.selector));x.attr(n[p.dynamicContent.name],""),x.attr("item",o),d(x)(e)}return e.$on("$destroy",function(){try{var b=j();if(b.length){for(var c=0,d=b.length;d>c;c++)a.element(b[c]).unbind();a.element(b).remove()}i().unbind(),p.removeItem(q)}catch(e){}try{q.destroy()}catch(e){}})}}}var f={columns:6,pushing:!0,floating:!0,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,isMobile:!1,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,mobileBreakPoint:600,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0}};a.module("fluidGrid",[]).constant("fluidGridConfig",f).controller("FluidGridCtrl",["fluidGridConfig",b]).directive("fluidGrid",["$timeout","$rootScope","$window",c]).controller("FluidGridItemCtrl",d).directive("fluidGridItem",["$parse","$document","$compile",e])}(angular);
//# sourceMappingURL=fluid-grid.min.map